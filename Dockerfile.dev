FROM debian:testing
WORKDIR /addonmaker
COPY packages.txt .
RUN apt update && apt -y install \
    cargo \
    git \
    libxml2-utils \
    luarocks \
    man \
    ninja-build \
    pre-commit \
    python3-pip \
    subversion \
    `cat packages.txt`
RUN cargo install --root=/usr/local --version=0.12.4 stylua
COPY requirements.txt .
RUN pip3 install -r requirements.txt
COPY rocks.txt .
RUN cat rocks.txt | xargs -n1 luarocks install
COPY *.lua *.py *.sh creds.json .pylintrc ./
RUN lua5.1 gencheck.lua > luacheckrc.lua
RUN luacheck *.lua && pylint *.py
WORKDIR /addon
